# PKQB 智能题库生成系统 - 开发文档

## 1. 项目概述

### 1.1 项目名称
PKQB (Problem & Knowledge Question Bank) - 智能题库生成系统

### 1.2 项目简介
一个基于 Spring Boot 和 Spring AI Alibaba 的智能体系统，能够根据用户提供的题目或笔记，自动生成对应的 HTML 页面。支持多种输入方式（Word、PDF、图片、文字），生成的页面风格简洁高级，具有交互功能。

### 1.3 技术栈
- **后端框架**: Spring Boot 4.0.1
- **后端语言**: Java 21
- **AI 框架**: Spring AI Alibaba
- **模板引擎**: Thymeleaf
- **ORM 框架**: MyBatis
- **前端技术**: HTML5, CSS3, JavaScript, Vue.js 3
- **文档解析**: Apache POI (Word), Apache PDFBox (PDF), Tesseract OCR (图片)
- **构建工具**: Maven

---

## 2. 需求分析

### 2.1 功能需求

#### 2.1.1 输入模块
| 功能 | 描述 |
|------|------|
| Word 文档上传 | 支持 .docx 格式文档上传 |
| PDF 文档上传 | 支持 .pdf 格式文档上传 |
| 图片上传 | 支持 .jpg, .png, .jpeg 格式图片上传，使用 OCR 识别文字 |
| 文字输入 | 支持直接输入或粘贴文本内容 |

#### 2.1.2 内容处理模块
| 功能 | 描述 |
|------|------|
| 内容类型识别 | 自动识别输入内容是题目还是笔记 |
| 内容解析 | 将上传的文档/图片解析为结构化数据 |
| AI 语义分析 | 使用 Spring AI Alibaba 进行内容理解和结构化 |
| 答案提取 | 针对题目类型，自动提取正确答案 |

#### 2.1.3 HTML 生成模块
| 功能 | 描述 |
|------|------|
| 题目页面生成 | 生成交互式答题页面，支持答案验证 |
| 笔记页面生成 | 生成知识点分框展示页面 |
| 样式生成 | 黑色背景，简洁高级的视觉风格 |
| 文件下载 | 生成的 HTML 文件支持用户下载保存 |

#### 2.1.4 交互功能模块
| 功能 | 描述 |
|------|------|
| 答题交互 | 用户可填写答案并提交 |
| 答案验证 | 提交后自动验证答案正确性 |
| 答案展示 | 显示正确答案和解析 |
| 进度追踪 | 显示答题进度和得分
|

### 2.2 非功能需求

| 需求类型 | 具体要求 |
|---------|---------|
| 性能 | 文件上传处理时间 < 30 秒，HTML 生成时间 < 5 秒 |
| 安全性 | 文件类型验证，文件大小限制，防止恶意上传 |
| 可用性 | 界面简洁直观，操作流程不超过 3 步 |
| 兼容性 | 支持主流浏览器（Chrome, Firefox, Edge, Safari） |
| 扩展性 | 模块化设计，便于后续功能扩展 |

---

## 3. 技术架构

### 3.1 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        前端层 (Vue.js 3)                       │
├─────────────────────────────────────────────────────────────┤
│  • 文件上传组件  • 内容展示区  • HTML 预览  • 下载功能       │
└────────────────────────────┬────────────────────────────────┘
                             │ HTTP/REST API
                             ↓
┌─────────────────────────────────────────────────────────────┐
│                    Spring Boot 应用层                         │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ Controller  │──│   Service   │──│   Model     │         │
│  │  (API)      │  │  (业务逻辑) │  │  (数据模型) │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└────────────────────────────┬────────────────────────────────┘
                             │
          ┌──────────────────┼──────────────────┐
          ↓                  ↓                  ↓
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ 文档解析器    │  │  Spring AI   │  │  MyBatis     │
│ (POI/PDFBox) │  │   Alibaba    │  │  (持久化)    │
└──────────────┘  └──────────────┘  └──────────────┘
```

### 3.2 项目目录结构

```
PKQB/
├── src/
│   ├── main/
│   │   ├── java/com/example/pkqb/
│   │   │   ├── PkqbApplication.java              # 启动类
│   │   │   ├── controller/
│   │   │   │   ├── FileUploadController.java     # 文件上传接口
│   │   │   │   ├── ContentController.java        # 内容处理接口
│   │   │   │   └── DownloadController.java       # 下载接口
│   │   │   ├── service/
│   │   │   │   ├── FileParserService.java        # 文件解析服务
│   │   │   │   ├── ContentAnalysisService.java   # 内容分析服务 (AI)
│   │   │   │   ├── HtmlGeneratorService.java     # HTML 生成服务
│   │   │   │   ├── WordParserService.java        # Word 解析
│   │   │   │   ├── PdfParserService.java         # PDF 解析
│   │   │   │   └── ImageOcrService.java          # 图片 OCR
│   │   │   ├── model/
│   │   │   │   ├── ContentRequest.java           # 请求模型
│   │   │   │   ├── ContentResponse.java          # 响应模型
│   │   │   │   ├── QuestionItem.java             # 题目模型
│   │   │   │   ├── NoteItem.java                 # 笔记模型
│   │   │   │   └── ContentType.java              # 内容类型枚举
│   │   │   ├── config/
│   │   │   │   ├── SpringAiConfig.java           # Spring AI 配置
│   │   │   │   └── FileUploadConfig.java         # 文件上传配置
│   │   │   └── exception/
│   │   │       ├── GlobalExceptionHandler.java   # 全局异常处理
│   │   │       └── BusinessException.java        # 业务异常
│   │   ├── resources/
│   │   │   ├── application.properties            # 应用配置
│   │   │   ├── templates/                        # Thymeleaf 模板
│   │   │   │   ├── index.html                    # 主页
│   │   │   │   ├── question-template.html        # 题目模板
│   │   │   │   └── note-template.html            # 笔记模板
│   │   │   └── static/                           # 静态资源
│   │   │       ├── css/
│   │   │       │   └── style.css                 # 全局样式
│   │   │       └── js/
│   │   │           └── main.js                   # 主要脚本
│   │   └── generated/                            # 生成的 HTML 存放目录
│   └── test/
│       └── java/com/example/pkqb/
│           ├── service/
│           │   ├── FileParserServiceTest.java
│           │   └── HtmlGeneratorServiceTest.java
│           └── controller/
│               └── FileUploadControllerTest.java
├── docs/
│   ├── 开发文档.md                                # 本文档
│   ├── API文档.md                                # API 接口文档
│   └── 数据库设计.md                              # 数据库设计文档
├── pom.xml                                       # Maven 配置
└── README.md                                     # 项目说明
```

---

## 4. 功能模块设计

### 4.1 文件上传模块

**职责**: 处理用户上传的 Word、PDF、图片文件

**核心类**:
- `FileUploadController`: 接收文件上传请求
- `FileUploadConfig`: 配置文件上传大小、类型限制

**接口设计**:
```
POST /api/upload
Content-Type: multipart/form-data

Request:
- file: 文件对象
- type: 文件类型 (word/pdf/image)

Response:
{
  "success": true,
  "data": {
    "fileId": "uuid",
    "fileName": "example.docx",
    "filePath": "/uploads/uuid.docx"
  }
}
```

### 4.2 内容解析模块

**职责**: 将上传的文档解析为纯文本内容

**核心类**:
- `WordParserService`: 解析 Word 文档
- `PdfParserService`: 解析 PDF 文档
- `ImageOcrService`: 使用 Tesseract OCR 识别图片文字

**接口设计**:
```
POST /api/parse
Content-Type: application/json

Request:
{
  "fileId": "uuid",
  "fileType": "word"
}

Response:
{
  "success": true,
  "data": {
    "text": "解析后的文本内容"
  }
}
```

### 4.3 内容分析模块 (AI)

**职责**: 使用 Spring AI Alibaba 分析内容，识别题目/笔记，提取结构化数据

**核心类**:
- `ContentAnalysisService`: 内容分析服务
- `SpringAiConfig`: AI 配置

**Prompt 设计**:

题目识别 Prompt:
```
请分析以下文本，判断它是题目还是笔记。如果是题目，请提取每个题目的问题、题型、选项和答案。

题型说明：
- single_choice: 单选题（只有一个正确答案）
- multiple_choice: 多选题（有多个正确答案，用逗号分隔）
- true_false: 判断题（正确/错误）

JSON格式要求：
{
  "type": "question|note",
  "items": [
    {
      "question": "题目内容",
      "questionType": "single_choice|multiple_choice|true_false",
      "options": ["A", "B", "C", "D"],  // 判断题可为空或包含["正确", "错误"]
      "answer": "正确答案，多选题用逗号分隔如：A,B,C",
      "explanation": "解析（可选）"
    }
  ]
}

文本内容：
{{content}}
```

笔记识别 Prompt:
```
请分析以下文本，提取知识点。每个知识点应该有标题和详细内容。以JSON格式返回。

JSON格式要求：
{
  "type": "question|note",
  "items": [
    {
      "title": "知识点标题",
      "content": "知识点详细内容"
    }
  ]
}

文本内容：
{{content}}
```

**接口设计**:
```
POST /api/analyze
Content-Type: application/json

Request:
{
  "text": "待分析的文本内容"
}

Response:
{
  "success": true,
  "data": {
    "type": "question",
    "items": [...]
  }
}
```

### 4.4 HTML 生成模块

**职责**: 根据分析结果生成交互式 HTML 页面

**核心类**:
- `HtmlGeneratorService`: HTML 生成服务

**题目页面设计** (支持单选题、多选题、判断题):
```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>题库 - {{title}}</title>
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Segoe UI', sans-serif;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
        }
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            transition: width 0.5s;
            z-index: 1000;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .header h1 {
            color: #00ff88;
            font-size: 32px;
            margin-bottom: 10px;
        }
        .score-board {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border: 1px solid #333;
            border-radius: 12px;
        }
        .score-item {
            font-size: 18px;
            color: #cccccc;
        }
        .score-item span {
            color: #00ff88;
            font-weight: bold;
            font-size: 24px;
        }
        .question-card {
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .question-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.7);
        }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            gap: 15px;
        }
        .question-title {
            font-size: 18px;
            color: #00ff88;
            flex: 1;
            line-height: 1.6;
        }
        .question-type {
            background: #2a2a2a;
            color: #00ff88;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
        }
        .question-type.single_choice {
            border: 1px solid #00ff88;
        }
        .question-type.multiple_choice {
            border: 1px solid #ffaa00;
            color: #ffaa00;
        }
        .question-type.true_false {
            border: 1px solid #00aaff;
            color: #00aaff;
        }
        .options {
            margin-top: 20px;
        }
        .option {
            padding: 14px 20px;
            margin: 10px 0;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .option:hover {
            background: #252525;
            border-color: #00ff88;
        }
        .option.selected {
            background: #00ff88;
            color: #000;
            border-color: #00ff88;
        }
        .option.correct {
            background: #00ff88;
            border-color: #00ff88;
            color: #000;
        }
        .option.wrong {
            background: #ff4444;
            border-color: #ff4444;
            color: #fff;
        }
        .option-text {
            flex: 1;
        }
        .answer-section {
            display: none;
            margin-top: 20px;
            padding: 15px 20px;
            background: #1a2a1a;
            border-left: 4px solid #00ff88;
            border-radius: 4px;
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .answer-section p {
            margin: 8px 0;
        }
        .answer-section strong {
            color: #00ff88;
        }
        .submit-btn {
            background: linear-gradient(145deg, #00ff88, #00cc6a);
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
        }
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
        }
        .submit-btn:disabled {
            background: #444;
            color: #888;
            cursor: not-allowed;
            box-shadow: none;
        }
        .stats-summary {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border-top: 1px solid #333;
            padding: 15px;
            text-align: center;
            font-size: 14px;
            color: #888;
        }
        .stats-summary span {
            color: #00ff88;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="progress-bar" id="progressBar"></div>

    <div class="header">
        <h1>题库练习</h1>
        <p style="color: #666;">共 {{totalQuestions}} 道题目</p>
    </div>

    <div class="score-board">
        <div class="score-item">得分: <span id="score">0</span></div>
        <div class="score-item">已完成: <span id="answered">0</span> / {{totalQuestions}}</div>
        <div class="score-item">正确率: <span id="accuracy">0%</span></div>
    </div>

    <!-- 题目列表 -->
    <div id="questions">
        {{#each items}}
        <div class="question-card" data-id="{{@index}}" data-type="{{questionType}}">
            <div class="question-header">
                <div class="question-title">{{@index + 1}}. {{question}}</div>
                <div class="question-type {{questionType}}">
                    {{#if (eq questionType "single_choice")}}单选题
                    {{else if (eq questionType "multiple_choice")}}多选题
                    {{else}}判断题{{/if}}
                </div>
            </div>
            <div class="options">
                {{#each options}}
                <div class="option" data-value="{{this}}">
                    <span class="option-text">{{this}}</span>
                </div>
                {{/each}}
            </div>
            <button class="submit-btn" onclick="checkAnswer({{@index}})">提交答案</button>
            <div class="answer-section" id="answer-{{@index}}">
                <p><strong>正确答案：</strong>{{answer}}</p>
                {{#if explanation}}
                <p><strong>解析：</strong>{{explanation}}</p>
                {{/if}}
            </div>
        </div>
        {{/each}}
    </div>

    <div class="stats-summary" id="statsSummary" style="display: none;">
        练习完成！<span id="finalScore"></span>
    </div>

    <script>
        // 题目数据（从模板渲染而来）
        const questionsData = [
            {{#each items}}
            {
                index: {{@index}},
                question: "{{question}}",
                questionType: "{{questionType}}",
                options: [{{#each options}}"{{this}}",{{/each}}],
                answer: "{{answer}}",
                explanation: "{{explanation}}"
            }{{#unless @last}},{{/unless}}
            {{/each}}
        ];

        let userAnswers = {};
        let score = 0;
        let answered = 0;

        // 单选题/判断题选择
        function selectSingleOption(questionIndex, value, element) {
            const options = document.querySelectorAll(`[data-id="${questionIndex}"] .option`);
            options.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            userAnswers[questionIndex] = [value];
        }

        // 多选题选择
        function selectMultipleOption(questionIndex, value, element) {
            element.classList.toggle('selected');

            if (!userAnswers[questionIndex]) {
                userAnswers[questionIndex] = [];
            }

            const index = userAnswers[questionIndex].indexOf(value);
            if (index > -1) {
                userAnswers[questionIndex].splice(index, 1);
            } else {
                userAnswers[questionIndex].push(value);
            }
        }

        // 检查答案
        function checkAnswer(questionIndex) {
            const selected = userAnswers[questionIndex];
            if (!selected || selected.length === 0) {
                alert('请先选择答案！');
                return;
            }

            const questionData = questionsData[questionIndex];
            const correctAnswers = questionData.answer.split(',').map(a => a.trim());
            const selectedAnswers = Array.isArray(selected) ? selected : [selected];

            // 计算是否正确
            const isCorrect = correctAnswers.length === selectedAnswers.length &&
                            correctAnswers.every(a => selectedAnswers.includes(a));

            const options = document.querySelectorAll(`[data-id="${questionIndex}"] .option`);
            options.forEach(opt => {
                const optValue = opt.dataset.value;
                if (correctAnswers.includes(optValue)) {
                    opt.classList.add('correct');
                } else if (opt.classList.contains('selected')) {
                    opt.classList.add('wrong');
                }
            });

            document.getElementById(`answer-${questionIndex}`).style.display = 'block';
            document.querySelector(`[data-id="${questionIndex}"] .submit-btn`).disabled = true;

            // 禁用所有选项
            options.forEach(opt => opt.style.pointerEvents = 'none');

            if (isCorrect) score++;
            answered++;

            updateStats();
        }

        // 更新统计信息
        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('answered').textContent = answered;

            const accuracy = answered > 0 ? Math.round((score / answered) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';

            document.getElementById('progressBar').style.width =
                (answered / {{totalQuestions}} * 100) + '%';

            // 检查是否全部完成
            if (answered >= {{totalQuestions}}) {
                showFinalStats();
            }
        }

        // 显示最终统计
        function showFinalStats() {
            const summary = document.getElementById('statsSummary');
            const accuracy = Math.round((score / {{totalQuestions}}) * 100);

            let message = '';
            if (accuracy === 100) {
                message = '太棒了！全部正确！';
            } else if (accuracy >= 80) {
                message = '做得很好！继续保持！';
            } else if (accuracy >= 60) {
                message = '还需努力，加油！';
            } else {
                message = '建议复习相关知识！';
            }

            document.getElementById('finalScore').textContent =
                `${message} 得分: ${score} / {{totalQuestions}} (${accuracy}%)`;
            summary.style.display = 'block';
        }

        // 初始化选项点击事件
        document.querySelectorAll('.option').forEach(option => {
            option.addEventListener('click', function() {
                const card = this.closest('.question-card');
                const questionIndex = parseInt(card.dataset.id);
                const questionType = card.dataset.type;
                const value = this.dataset.value;

                if (questionType === 'single_choice' || questionType === 'true_false') {
                    selectSingleOption(questionIndex, value, this);
                } else if (questionType === 'multiple_choice') {
                    selectMultipleOption(questionIndex, value, this);
                }
            });
        });
    </script>
</body>
</html>
```

**笔记页面设计**:
```html
<!DOCTYPE html>
<html>
<head>
    <title>学习笔记 - {{title}}</title>
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Segoe UI', sans-serif;
            padding: 40px;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .header h1 {
            color: #00ff88;
            font-size: 32px;
            margin-bottom: 10px;
        }
        .note-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        .note-card {
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .note-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.7);
        }
        .note-title {
            color: #00ff88;
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #333;
        }
        .note-content {
            color: #cccccc;
            line-height: 1.8;
            white-space: pre-wrap;
        }
        .toc {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .toc h3 {
            color: #00ff88;
            margin-top: 0;
        }
        .toc ul {
            list-style: none;
            padding: 0;
        }
        .toc li {
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }
        .toc a {
            color: #cccccc;
            text-decoration: none;
            transition: color 0.3s;
        }
        .toc a:hover {
            color: #00ff88;
        }
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(145deg, #00ff88, #00cc6a);
            color: #000;
            border: none;
            padding: 15px 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .back-to-top.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>学习笔记</h1>
        <p style="color: #666;">共 {{totalNotes}} 个知识点</p>
    </div>

    <div class="toc">
        <h3>目录</h3>
        <ul>
            {{#each items}}
            <li><a href="#note-{{@index}}">{{title}}</a></li>
            {{/each}}
        </ul>
    </div>

    <div class="note-grid">
        {{#each items}}
        <div class="note-card" id="note-{{@index}}">
            <div class="note-title">{{title}}</div>
            <div class="note-content">{{content}}</div>
        </div>
        {{/each}}
    </div>

    <button class="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">↑</button>

    <script>
        window.addEventListener('scroll', function() {
            const btn = document.querySelector('.back-to-top');
            if (window.pageYOffset > 300) {
                btn.classList.add('visible');
            } else {
                btn.classList.remove('visible');
            }
        });

        // 平滑滚动
        document.querySelectorAll('.toc a').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });
    </script>
</body>
</html>
```

**接口设计**:
```
POST /api/generate
Content-Type: application/json

Request:
{
  "type": "question",
  "title": "题库标题",
  "items": [...]
}

Response:
{
  "success": true,
  "data": {
    "fileId": "uuid",
    "fileName": "generated-questions.html",
    "downloadUrl": "/api/download/uuid"
  }
}
```

### 4.5 下载模块

**职责**: 提供生成的 HTML 文件下载功能

**核心类**:
- `DownloadController`: 处理下载请求

**接口设计**:
```
GET /api/download/{fileId}
Response: HTML 文件流
```

---

## 5. 数据模型设计

### 5.1 请求模型

```java
// ContentRequest.java
public class ContentRequest {
    private String text;           // 文本内容
    private String fileId;         // 文件ID（如果有上传文件）
    private String fileType;       // 文件类型：word/pdf/image/text
}
```

### 5.2 响应模型

```java
// ContentResponse.java
public class ContentResponse {
    private boolean success;
    private String message;
    private Object data;
}

// QuestionItem.java
public class QuestionItem {
    private String question;       // 题目内容
    private QuestionType questionType;  // 题目类型
    private List<String> options;  // 选项列表（判断题可为空）
    private String answer;         // 正确答案（多选题用逗号分隔如：A,B,C）
    private String explanation;    // 答案解析
}

// NoteItem.java
public class NoteItem {
    private String title;          // 知识点标题
    private String content;        // 知识点内容
}

// ContentType.java
public enum ContentType {
    QUESTION("question"),  // 题目
    NOTE("note");          // 笔记

    private final String value;
}

// QuestionType.java - 题目类型枚举
public enum QuestionType {
    SINGLE_CHOICE("single_choice", "单选题"),    // 单选题
    MULTIPLE_CHOICE("multiple_choice", "多选题"), // 多选题
    TRUE_FALSE("true_false", "判断题");          // 判断题

    private final String value;
    private final String description;
}
```

---

## 6. API 接口文档

### 6.1 文件上传接口

**URL**: `POST /api/upload`

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| file | File | 是 | 上传的文件 |
| type | String | 是 | 文件类型：word/pdf/image |

**响应示例**:
```json
{
  "success": true,
  "message": "文件上传成功",
  "data": {
    "fileId": "550e8400-e29b-41d4-a716-446655440000",
    "fileName": "exam.docx",
    "filePath": "/uploads/550e8400-e29b-41d4-a716-446655440000.docx"
  }
}
```

### 6.2 内容解析接口

**URL**: `POST /api/parse`

**请求参数**:
```json
{
  "fileId": "550e8400-e29b-41d4-a716-446655440000",
  "fileType": "word"
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "解析成功",
  "data": {
    "text": "1. 下列哪个是 Java 的基本数据类型？\nA. String\nB. int\nC. Integer\nD. Object\n答案：B\n\n2. ..."
  }
}
```

### 6.3 内容分析接口

**URL**: `POST /api/analyze`

**请求参数**:
```json
{
  "text": "待分析的文本内容"
}
```

**响应示例 (题目 - 单选题)**:
```json
{
  "success": true,
  "message": "分析成功",
  "data": {
    "type": "question",
    "title": "Java 基础题库",
    "items": [
      {
        "question": "下列哪个是 Java 的基本数据类型？",
        "questionType": "single_choice",
        "options": ["A. String", "B. int", "C. Integer", "D. Object"],
        "answer": "B",
        "explanation": "int 是 Java 的基本数据类型，String 和 Integer 是引用类型"
      }
    ]
  }
}
```

**响应示例 (题目 - 多选题)**:
```json
{
  "success": true,
  "message": "分析成功",
  "data": {
    "type": "question",
    "title": "Java 基础题库",
    "items": [
      {
        "question": "下列哪些是 Java 的基本数据类型？",
        "questionType": "multiple_choice",
        "options": ["A. int", "B. String", "C. boolean", "D. Integer"],
        "answer": "A,C",
        "explanation": "int 和 boolean 是基本数据类型"
      }
    ]
  }
}
```

**响应示例 (题目 - 判断题)**:
```json
{
  "success": true,
  "message": "分析成功",
  "data": {
    "type": "question",
    "title": "Java 基础题库",
    "items": [
      {
        "question": "Java 中 String 是基本数据类型。",
        "questionType": "true_false",
        "options": ["正确", "错误"],
        "answer": "错误",
        "explanation": "String 是引用类型，不是基本数据类型"
      }
    ]
  }
}
```

**响应示例 (笔记)**:
```json
{
  "success": true,
  "message": "分析成功",
  "data": {
    "type": "note",
    "title": "Java 学习笔记",
    "items": [
      {
        "title": "基本数据类型",
        "content": "Java 有 8 种基本数据类型：byte, short, int, long, float, double, char, boolean"
      }
    ]
  }
}
```

### 6.4 HTML 生成接口

**URL**: `POST /api/generate`

**请求参数**:
```json
{
  "type": "question",
  "title": "题库标题",
  "items": [
    {
      "question": "题目内容",
      "questionType": "single_choice",
      "options": ["A", "B", "C", "D"],
      "answer": "B",
      "explanation": "解析内容"
    }
  ]
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "生成成功",
  "data": {
    "fileId": "660e8400-e29b-41d4-a716-446655440001",
    "fileName": "questions-20250116-143022.html",
    "downloadUrl": "/api/download/660e8400-e29b-41d4-a716-446655440001"
  }
}
```

### 6.5 下载接口

**URL**: `GET /api/download/{fileId}`

**响应**: HTML 文件流

---

## 7. 配置文件

### 7.1 Maven 依赖 (pom.xml)

```xml
<dependencies>
    <!-- Spring Boot -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webmvc</artifactId>
    </dependency>

    <!-- Thymeleaf -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-thymeleaf</artifactId>
    </dependency>

    <!-- MyBatis -->
    <dependency>
        <groupId>org.mybatis.spring.boot</groupId>
        <artifactId>mybatis-spring-boot-starter</artifactId>
        <version>4.0.1</version>
    </dependency>

    <!-- Spring AI Alibaba -->
    <dependency>
        <groupId>com.alibaba.cloud.ai</groupId>
        <artifactId>spring-ai-alibaba-starter</artifactId>
        <version>1.0.0-M2</version>
    </dependency>

    <!-- Apache POI (Word) -->
    <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi-ooxml</artifactId>
        <version>5.2.5</version>
    </dependency>

    <!-- Apache PDFBox (PDF) -->
    <dependency>
        <groupId>org.apache.pdfbox</groupId>
        <artifactId>pdfbox</artifactId>
        <version>2.0.30</version>
    </dependency>

    <!-- Tesseract OCR -->
    <dependency>
        <groupId>net.sourceforge.tess4j</groupId>
        <artifactId>tess4j</artifactId>
        <version>5.7.0</version>
    </dependency>

    <!-- Handlebars (模板引擎) -->
    <dependency>
        <groupId>com.github.jknack</groupId>
        <artifactId>handlebars</artifactId>
        <version>4.3.1</version>
    </dependency>

    <!-- Lombok -->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>

    <!-- 测试 -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
```

### 7.2 application.properties

```properties
# 应用配置
spring.application.name=PKQB
server.port=8080

# 文件上传配置
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB
app.upload.path=D:/java/PKQB/uploads
app.generated.path=D:/java/PKQB/generated

# Spring AI Alibaba 配置
spring.ai.dashscope.api-key=your-api-key
spring.ai.dashscope.chat.enabled=true
spring.ai.dashscope.chat.options.model=qwen-plus

# Thymeleaf 配置
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.cache=false

# 日志配置
logging.level.com.example.pkqb=DEBUG
logging.level.org.springframework.web=INFO

# OCR 配置
app.ocr.data-path=C:/Program Files/Tesseract-OCR/tessdata
app.ocr.language=chi_sim+eng
```

---

## 8. 开发计划

### 阶段一：项目搭建 (Week 1)
- [ ] 初始化 Spring Boot 项目
- [ ] 配置 Maven 依赖
- [ ] 搭建项目目录结构
- [ ] 配置 application.properties

### 阶段二：后端核心功能 (Week 2-3)
- [ ] 实现文件上传功能
- [ ] 实现 Word 文档解析
- [ ] 实现 PDF 文档解析
- [ ] 实现图片 OCR 识别

### 阶段三：AI 集成 (Week 3-4)
- [ ] 配置 Spring AI Alibaba
- [ ] 实现内容类型识别
- [ ] 实现题目结构化提取
- [ ] 实现笔记结构化提取

### 阶段四：HTML 生成 (Week 4)
- [ ] 设计题目 HTML 模板
- [ ] 设计笔记 HTML 模板
- [ ] 实现模板渲染引擎
- [ ] 实现文件下载功能

### 阶段五：前端开发 (Week 5)
- [ ] 设计 UI 界面
- [ ] 实现文件上传组件
- [ ] 实现内容预览组件
- [ ] 实现下载功能

### 阶段六：测试与优化 (Week 6)
- [ ] 单元测试
- [ ] 集成测试
- [ ] 性能优化
- [ ] Bug 修复

---

## 9. 部署方案

### 9.1 本地部署

```bash
# 1. 克隆项目
git clone <repository-url>
cd PKQB

# 2. 安装 Tesseract OCR
# Windows: 下载安装包并配置环境变量

# 3. 配置 application.properties
# 修改 spring.ai.dashscope.api-key

# 4. 编译项目
mvn clean package

# 5. 运行应用
java -jar target/PKQB-0.0.1-SNAPSHOT.jar

# 6. 访问
http://localhost:8080
```

### 9.2 Docker 部署

```dockerfile
FROM openjdk:21-jdk-slim

# 安装 Tesseract OCR
RUN apt-get update && \
    apt-get install -y tesseract-ocr tesseract-ocr-chi-sim && \
    apt-get clean

# 复制 JAR 文件
COPY target/PKQB-0.0.1-SNAPSHOT.jar app.jar

# 创建工作目录
RUN mkdir -p /app/uploads /app/generated

# 暴露端口
EXPOSE 8080

# 运行应用
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

```bash
# 构建镜像
docker build -t pkqb:latest .

# 运行容器
docker run -d -p 8080:8080 \
  -v $(pwd)/uploads:/app/uploads \
  -v $(pwd)/generated:/app/generated \
  -e SPRING_AI_DASHSCOPE_API_KEY=your-api-key \
  pkqb:latest
```

---

## 10. 注意事项

### 10.1 安全性
- 严格验证上传文件的类型和内容
- 限制文件大小，防止恶意上传
- 定期清理临时文件
- API 密钥不要提交到代码仓库

### 10.2 性能优化
- 大文件处理考虑使用异步方式
- OCR 处理较慢，可添加进度提示
- 生成的 HTML 文件可考虑缓存

### 10.3 AI 使用限制
- 注意调用频率限制
- 考虑错误重试机制
- 记录 AI 调用日志，便于问题排查

### 10.4 浏览器兼容性
- 测试主流浏览器兼容性
- 注意不同浏览器对 ES6+ 的支持情况

---

## 11. 扩展方向

1. **支持更多格式**: Excel, PPT, Markdown
2. **多语言支持**: 中英文混合处理
3. **题库管理**: 保存历史生成的题库
4. **统计分析**: 答题正确率统计
5. **导出其他格式**: PDF, Markdown
6. **协作功能**: 分享题库给其他用户
7. **移动端适配**: 响应式设计
8. **AI 优化**: 根据用户反馈优化 AI 提示词

---

## 附录

### A. 参考资料
- [Spring Boot 官方文档](https://spring.io/projects/spring-boot)
- [Spring AI Alibaba 文档](https://sca.aliyun.com/ai/)
- [Apache POI 文档](https://poi.apache.org/)
- [Apache PDFBox 文档](https://pdfbox.apache.org/)
- [Tess4J 文档](https://tess4j.sourceforge.net/)

### B. 问题反馈
如有问题，请提交 Issue 或联系开发团队。

---

**文档版本**: v1.0
**最后更新**: 2025-01-16
**文档作者**: Claude Code